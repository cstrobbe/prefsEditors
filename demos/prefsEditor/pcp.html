<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>PCP</title>

    <!-- The needed infusion CSS files -->
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/fss/css/fss-reset-global.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/fss/css/fss-base-global.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/fss/css/fss-layout.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/fss/css/fss-text.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-text-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-bw-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-wb-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-lgdg-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-dglg-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-yb-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/fss/fss-theme-by-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/PrefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/lib/infusion/framework/preferences/css/FullPrefsEditor.css" />

    <!-- Needed fonts from Google -->
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>

    <!-- All styling for PMT is here -->
    <link rel="stylesheet" type="text/css" href="../../src/shared/adjusters/css/fss-theme-inverted-prefsEditor.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/adjusters/css/adjusters.css" />
    <link rel="stylesheet" type="text/css" href="../../src/shared/frames/css/frames.css" />

    <!-- This is breaking the slider color -->
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/combobox.js"></script>

    <!-- The Infusion Library -->
    <script type="text/javascript" src="../../src/shared/lib/infusion/infusion-prefsFramework.js"></script>

    <!-- The common JS files -->
    <script type="text/javascript" src="../../src/shared/common/ariaUtility.js"></script>
    <script type="text/javascript" src="../../src/shared/common/eventUtility.js"></script>
    <script type="text/javascript" src="../../src/shared/common/merging.js"></script>
    <script type="text/javascript" src="../../src/shared/common/OSDetection.js"></script>

    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/activatableLabelsClickOnActivate.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/singleSelectionWithKeyboard.js"></script>

    <script type="text/javascript" src="../../src/shared/frames/js/GPIIPrefsEditor.js"></script>

    <!-- The custom adjusters JS files -->
    <script type="text/javascript" src="../../src/shared/components/preview/js/preview.js"></script>
    <script type="text/javascript" src="../../src/shared/components/textfieldStepper/js/textfieldStepper.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/expandingAdjusters.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/textfieldStepper.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/onOffSwitch.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/iconCheck.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/addContrast.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/contrastThemeNoPreview.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/contrastEnabled.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/increaseSizePCP.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/increaseSizePMT.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/textSizePCP.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/textSizePMT.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/cursorSizePCP.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/cursorSizePMT.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierEnabled.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierPCP.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierPMT.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierInvertColours.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierPosition.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/followingElement.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/magnifierFollowsFollowingElement.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/screenReaderFollowsFollowingElement.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/showCrosshairs.js"></script>

    <!-- The JS files of the enactors of my custom adjusters -->
    <script type="text/javascript" src="../../src/shared/enactors/js/contrastThemeNoPreview.js"></script>
    <script type="text/javascript" src="../../src/shared/enactors/js/textSize.js"></script>
    <script type="text/javascript" src="../../src/shared/enactors/js/cursorSize.js"></script>
    <script type="text/javascript" src="../../src/shared/enactors/js/magnifier.js"></script>

    <!-- The i18n JS files -->
    <script type="text/javascript" src="../../src/shared/i18n/js/i18n.js"></script>

    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/Panels.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/applicationTerms/Panels.js"></script>

    <!-- PMT-specific files -->
    <script type="text/javascript" src="../../src/shared/schemas/js/primarySchema.js"></script>
    <script type="text/javascript" src="../../src/shared/schemas/js/commonTermsAuxSchemaData.js"></script>
    <script type="text/javascript" src="../../src/shared/schemas/js/applicationTermsAuxSchemaData.js"></script>
    <script type="text/javascript" src="../../src/shared/schemas/js/pcpSchema.js"></script>
    <script type="text/javascript" src="../../src/shared/common/GpiiSession.js"></script>
    <script type="text/javascript" src="../../src/shared/common/GpiiStore.js"></script>

    <!-- Socket.io-client library -->
    <script type="text/javascript" src="../../src/shared/lib/socket.io/socket.io.js"></script>

    <!-- PCPteam-specific files -->
    <script type="text/javascript" src="../../src/pcp/js/prefsEditor.js"></script>
    <script type="text/javascript" src="../../src/pcp/js/socket.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/languageCollectivePanel.js"></script>
    <script type="text/javascript" src="../../src/pcp/js/visualAlternativesCollectivePanel.js"></script>
    <script type="text/javascript" src="../../src/shared/adjusters/js/commonTerms/volumeCollectivePanel.js"></script>

    <script type="text/javascript" src="../../src/pcp/js/starter.js"></script>

    <!-- The demo script -->
    <script type="text/javascript" src="demo.js"></script>

</head>
<body>
    <!-- This is the div that will contain the UI Options component -->
    <div id="gpiic-pcp">
    </div>

    <script>
         var socket = io.connect("http://localhost:8081/pcp");
        // var pcp = gpii.pcp.starter();
        var pcp = null;
        socket.on("connect", function () {
            socket.emit("message", {}, fluid.log);
        });

        var isReady = false;
        var messageQueue = [];

        socket.on("setAdjusters", function (adjusters) {
            console.log("Socket received adjusters "+JSON.stringify(adjusters, null, 2));
            if (adjusters) {
                if (pcp) {
                    console.log("EXISTING PCP FOUND - destroying");
                    pcp.destroy();
                }
                isReady = false;
                pcp = gpii.pcp.starter(); // new starter in order to refresh member fields
                document.getElementById("gpiic-pcp").innerHTML = "";
                pcp.renderAdjusters(adjusters);
            };

            gpii.pcp.onPrefsEditorReady = function () {
                console.log("The prefs editor is now ready")
                isReady = true;
                fluid.each(messageQueue, function (message) {
                    pcp.showMessage(message);
                });
                messageQueue = [];
            };
        });

        socket.on("message", function (message) {
            console.log("Socket received message "+JSON.stringify(message, null, 2));
            messageQueue = messageQueue.concat([message]);
            console.log("Queue is now: "+JSON.stringify(messageQueue, null, 2));
            if (isReady) {
                console.log("PCP ready to display messages");
                fluid.each(messageQueue, function (msg) {
                    pcp.showMessage(msg);
                });
                messageQueue = [];
            }
        });
    </script>

</body>
</html>
